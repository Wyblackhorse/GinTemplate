<!DOCTYPE html><html><head>    <meta charset="utf-8">    <title>layui</title>    <meta name="renderer" content="webkit">    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">    <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">    <link rel="stylesheet" href="../css/public.css" media="all"></head><body><div class="layuimini-container">    <div class="layuimini-main">        <fieldset class="table-search-fieldset">            <legend>搜索信息</legend>            <div style="margin: 10px 10px 10px 10px">                <form class="layui-form layui-form-pane" action="">                    <div class="layui-form-item">                        <div class="layui-inline">                            <label class="layui-form-label">用户姓名</label>                            <div class="layui-input-inline">                                <input type="text" name="username" autocomplete="off" class="layui-input">                            </div>                        </div>                        <div class="layui-inline">                            <label class="layui-form-label">用户性别</label>                            <div class="layui-input-inline">                                <input type="text" name="sex" autocomplete="off" class="layui-input">                            </div>                        </div>                        <div class="layui-inline">                            <label class="layui-form-label">用户城市</label>                            <div class="layui-input-inline">                                <input type="text" name="city" autocomplete="off" class="layui-input">                            </div>                        </div>                        <div class="layui-inline">                            <label class="layui-form-label">用户职业</label>                            <div class="layui-input-inline">                                <input type="text" name="classify" autocomplete="off" class="layui-input">                            </div>                        </div>                        <div class="layui-inline">                            <button type="submit" class="layui-btn layui-btn-primary" lay-submit                                    lay-filter="data-search-btn"><i class="layui-icon"></i> 搜 索                            </button>                        </div>                    </div>                </form>            </div>        </fieldset>        <script type="text/html" id="toolbarDemo">            <!--                <button class="layui-btn layui-btn-normal layui-btn-sm data-add-btn" lay-event="add"> 添加</button>-->            <!--                <button class="layui-btn layui-btn-sm layui-btn-danger data-delete-btn" lay-event="delete"> 删除</button>-->            <div class="layui-form-item">                <!--                    <div class="layui-inline">-->                <!--                        <label class="layui-form-label">IP地址</label>-->                <!--                        <div class="layui-input-inline">-->                <!--                            <input type="text" id="ipaddress"  autocomplete="off" class="layui-input" value="127.0.0.1:7777">-->                <!--                        </div>-->                <!--                    </div>-->                <div class="layui-inline">                    <label class="layui-form-label">gas</label>                    <div class="layui-input-inline">                        <input type="text" id="gas" autocomplete="off" class="layui-input" value="10">                    </div>                </div>                <div class="layui-inline">                    <label class="layui-form-label">min</label>                    <div class="layui-input-inline">                        <input type="text" id="min" autocomplete="off" class="layui-input" value="2000">                    </div>                </div>                <div class="layui-inline">                    <button class="layui-btn layui-btn-normal layui-btn-sm data-add-btn" lay-event="addAddress"> 添加地址                    </button>                </div>                <div class="layui-inline">                    <label class="layui-form-label" style="color: red">总余额:</label>                    <div class="layui-input-inline">                        <input type="text" id="AllMoney" autocomplete="off" class="layui-input" readonly="readonly"                               value="">                    </div>                </div>                <div class="layui-inline">                    <button class="layui-btn layui-btn-normal layui-btn-sm data-add-btn" lay-event="updateMoney"> 更新余额                    </button>                </div>            </div>            <div class="layui-form-item">                <div class="layui-inline">                    <label class="layui-form-label">addr</label>                    <div class="layui-input-inline" style="width: 420px">                        <!--                        <input type="text" id="addr" autocomplete="off" class="layui-input" value="" >-->                        <textarea placeholder="请输入内容" id="addr" class="layui-textarea"                                  style="width: 400px;height: 40px!important;"></textarea>                    </div>                </div>                <div class="layui-inline">                    <button class="layui-btn layui-btn-normal layui-btn-sm data-add-btn" lay-event="add">资金归集</button>                </div>            </div>        </script>        <table class="layui-hide" id="currentTableId" lay-filter="currentTableFilter"></table>        <script type="text/html" id="currentTableBar">            <a class="layui-btn layui-btn-normal layui-btn-xs data-count-edit" lay-event="edit">编辑</a>            <a class="layui-btn layui-btn-xs layui-btn-danger data-count-delete" lay-event="delete">删除</a>        </script>    </div></div><script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script><script>    layui.use(['form', 'table'], function () {        var $ = layui.jquery,            form = layui.form,            table = layui.table;        $.ajax({            url: "/v2/getAllMoney",            type: "get",            dataType: "json",            success: function (data) {                if (data.code === 200) {                    $("#AllMoney").val(data.result)                }            },            error: function (data) {                layer.alert(JSON.stringify(data), {                    title: data                });            }        });        table.render({            elem: '#currentTableId',            url: '/v2/getReceiveAddress?action=GET',            toolbar: '#toolbarDemo',            height: screen.height * 0.7,            defaultToolbar: ['filter', 'exports', 'print', {                title: '提示',                layEvent: 'LAYTABLE_TIPS',                icon: 'layui-icon-tips'            }],            cols: [[                {type: "checkbox", width: 50},                {field: 'ID', width: 80, title: 'ID', sort: true},                {field: 'Username', width: 300, title: '用户名', align: "center"},                {field: 'Money', width: 300, title: '账户余额', align: "center"},                {field: 'ReceiveNums', width: 150, title: '充值次数', sort: true, align: "center"},                {field: 'LastGetAccount', width: 150, title: '最后一次充值金额', align: "center"},                {field: 'Address', title: '充值地址', minWidth: 300, align: "center"},                {                    field: 'Updated', width: 200, title: '更新时间', sort: true, align: "center",                    templet: "<div>{{layui.util.toDateString(d.Updated*1000, 'yyyy-MM-dd HH:mm:ss')}}</div>"                },                {                    field: 'Created', width: 200, title: '入库时间', sort: true, align: "center",                    templet: "<div>{{layui.util.toDateString(d.Created*1000, 'yyyy-MM-dd HH:mm:ss')}}</div>"                },                {title: '操作', minWidth: 150, toolbar: '#currentTableBar', align: "center"}            ]],            limits: [10, 15, 20, 25, 50, 100],            limit: 20,            page: true,            skin: 'line'        });        // 监听搜索操作        form.on('submit(data-search-btn)', function (data) {            var result = JSON.stringify(data.field);            layer.alert(result, {                title: '最终的搜索信息'            });            //执行搜索重载            table.reload('currentTableId', {                page: {                    curr: 1                }                , where: {                    searchParams: result                }            }, 'data');            return false;        });        /**         * toolbar监听事件         */        table.on('toolbar(currentTableFilter)', function (obj) {            if (obj.event === 'add') {  // 监听添加操作 10                let addressStr = $("#addr").val()                let addressArray = addressStr.split("\n")                // let addressArrayToStr = addressArray.toString()                // addressArrayToStr = "["+addressArrayToStr+"]"                let tempStr = ""                addressArray.forEach((item, index) => {                    // tempStr = tempStr + '"' + item + '",'                    tempStr = tempStr + item + '@'                })                tempStr = tempStr.substring(0, tempStr.length - 1)                // tempStr = tempStr + ']'                console.log("tempStr",tempStr)                let paramUrl = "/v2/collection"                // paramUrl = paramUrl + $("#ipaddress").val() + '/collect'                paramUrl = paramUrl + "?gas=" + $("#gas").val() + "000000"                paramUrl = paramUrl + "&min=" + $("#min").val() + "000000"                paramUrl = paramUrl + "&ts=" + Date.now()                paramUrl = paramUrl + "&addr=" + tempStr                $.ajax({                    url: paramUrl,                    type: 'GET',                    dataType: "json",                    success: function (resultJson) {                        if (resultJson.code === 200) {                            layui.msg(resultJson.msg)                        }                    },                });            } else if (obj.event === 'delete') {  // 监听删除操作                var checkStatus = table.checkStatus('currentTableId')                    , data = checkStatus.data;                layer.alert(JSON.stringify(data));            } else if (obj.event === "addAddress") {                $.ajax({                    url: "/v2/getReceiveAddress?action=ADD",                    type: "get",                    dataType: "json",                    success: function (data) {                        if (data.code === 200) {                            layer.msg("添加成功");                        }                        var result = JSON.stringify(data.field);                        //执行搜索重载                        table.reload('currentTableId', {                            page: {                                curr: 1                            }                            , where: {                                searchParams: result                            }                        }, 'data');                    },                    error: function (data) {                        layer.alert(JSON.stringify(data), {                            title: data                        });                    }                });            }else if (obj.event==="updateMoney"){                $.ajax({                    url: "/v2/getAllMoney",                    type: "get",                    dataType: "json",                    success: function (data) {                        if (data.code === 200) {                            $("#AllMoney").val(data.result)                            layer.msg("更新成功")                        }else{                            layer.msg("更新失败")                        }                    },                    error: function (data) {                        layer.alert(JSON.stringify(data), {                            title: data                        });                    }                });            }        });        //监听表格复选框选择        table.on('checkbox(currentTableFilter)', function (obj) {            console.log(obj)        });        table.on('tool(currentTableFilter)', function (obj) {            var data = obj.data;            if (obj.event === 'edit') {                var index = layer.open({                    title: '编辑用户',                    type: 2,                    shade: 0.2,                    maxmin: true,                    shadeClose: true,                    area: ['100%', '100%'],                    content: '../page/table/edit.html',                });                $(window).on("resize", function () {                    layer.full(index);                });                return false;            } else if (obj.event === 'delete') {                layer.confirm('真的删除行么', function (index) {                    obj.del();                    layer.close(index);                });            }        });    });</script></body></html>